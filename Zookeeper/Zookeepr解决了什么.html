<div class="post">
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/likehua/p/3999600.html">zookeeper适用场景：zookeeper解决了哪些问题</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body"><p>问题导读：<br><span style="color: #ff0000;">1.master挂机，传统做法备份必然是以前数据，该如何保证挂机数据与备份数据一致？</span><br><span style="color: #ff0000;">2.分布式系统如何实现对同一资源的访问，保证数据的强一致性？</span><br><span style="color: #ff0000;">3.集群中的worker挂了，传统做法是什么？zookeeper又是如何做的？</span><br><br><img id="aimg_REfFw" class="zoom" src="http://www.aboutyun.com/static/image/hrline/4.gif" alt="" width="500" height="35" border="0"><br><br><br><br>分布式系统的运行是很复杂的，因为涉及到了网络通信还有节点失效等不可控的情况。下面介绍在最传统的<span><span><a id="7_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Eaboutyun%2Ecom%2Fthread%2D9266%2D1%2D1%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=92051019_cpr&amp;k=master&amp;k0=master&amp;kdi0=8&amp;k1=%B7%D6%B2%BC%CA%BD&amp;kdi1=1&amp;k2=%C4%A3%D0%CD&amp;kdi2=1&amp;k3=%CD%A8%D0%C5&amp;kdi3=8&amp;k4=%BC%E0%BF%D8&amp;kdi4=8&amp;sid=68fcd10e2eb6714f&amp;ch=0&amp;tu=u1692056&amp;jk=183ed004c199001e&amp;cf=29&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=1&amp;seller_id=1&amp;di=128" target="_blank">master</a>-workers<span><a id="8_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Eaboutyun%2Ecom%2Fthread%2D9266%2D1%2D1%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=92051019_cpr&amp;k=%C4%A3%D0%CD&amp;k0=master&amp;kdi0=8&amp;k1=%B7%D6%B2%BC%CA%BD&amp;kdi1=1&amp;k2=%C4%A3%D0%CD&amp;kdi2=1&amp;k3=%CD%A8%D0%C5&amp;kdi3=8&amp;k4=%BC%E0%BF%D8&amp;kdi4=8&amp;sid=68fcd10e2eb6714f&amp;ch=0&amp;tu=u1692056&amp;jk=183ed004c199001e&amp;cf=29&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=3&amp;seller_id=1&amp;di=128" target="_blank">模型</a>，主要可以会遇到什么问题，传统方法是怎么解决以及怎么用zookeeper解决。<br><br>Master节点管理<br>集群当中最重要的是Master，所以一般都会设置一台Master的Backup。<br><br>Backup会定期向Master获取Meta信息并且检测Master的存活性，一旦Master挂了，Backup立马启动，接替Master的工作自己成为Master，分布式的情况多种多样，因为涉及到了网络<span><a id="6_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Eaboutyun%2Ecom%2Fthread%2D9266%2D1%2D1%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=92051019_cpr&amp;k=%CD%A8%D0%C5&amp;k0=master&amp;kdi0=8&amp;k1=%B7%D6%B2%BC%CA%BD&amp;kdi1=1&amp;k2=%C4%A3%D0%CD&amp;kdi2=1&amp;k3=%CD%A8%D0%C5&amp;kdi3=8&amp;k4=%BC%E0%BF%D8&amp;kdi4=8&amp;sid=68fcd10e2eb6714f&amp;ch=0&amp;tu=u1692056&amp;jk=183ed004c199001e&amp;cf=29&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=4&amp;seller_id=1&amp;di=128" target="_blank">通信</a>的抖动，针对下面的情况:<br></span></span></span></span></p>
<ul class="litype_1" type="1">
<li>Backup检测Master存活性传统的就是定期发包，一旦一定时间段内没有收到响应就判定Master Down了，于是Backup就启动，如果Master其实是没有down，Backup收不到响应或者收到响应延迟的原因是因为网络阻塞的问题呢？Backup也启动了，这时候集群里就有了两个Master，很有可能部分workers汇报给Master，另一部分workers汇报给后来启动的Backup，这下子服务就全乱了。</li>
<li>Backup是定期同步Master中的meta信息，所以总是滞后的，一旦Master挂了，Backup的信息必然是老的，很有可能会影响集群运行状态。</li>


</ul>
<p>
<span><span><span><span>解决问题:<br></span></span></span></span></p>
<ul>
<li>Master节点高可用，并且保证唯一。</li>
<li>Meta信息的及时同步</li>


</ul>
<p>
<span><span><span><span><br>zookeeper Master选举<br><br>zookeeper会分配给注册到它上面的客户端一个编号，并且zk自己会保证这个编号的唯一性和递增性，N多机器中只需选出编号最小的Client作为Master就行，并且保证这些机器的都维护一个一样的meta信息视图，一旦Master挂了，那么这N机器中编号最小的胜任Master，Meta信息是一致的。<br><br>配置文件管理<br><br>集群中配置文件的更新和同步是很频繁的，传统的配置文件分发都是需要把配置文件数据分发到每台worker上，然后进行worker的reload，这种方式是最笨的方式，结构很难维护，因为如果集群当中有可能很多种应用的配置文件要同步，而且效率很低，集群规模一大负载很高。还有一种就是每次更新把配置文件单独保存到一个数据库里面，然后worker端定期pull数据，这种方式就是数据及时性得不到同步。<br><br>解决问题:<br></span></span></span></span></p>
<ul>
<li>统一配置文件分发并且及时让worker生效</li>


</ul>
<p>
<span><span><span><span><br>zookeeper发布与订阅模型<br>发布与订阅<span><a id="5_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Eaboutyun%2Ecom%2Fthread%2D9266%2D1%2D1%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=92051019_cpr&amp;k=%C4%A3%D0%CD&amp;k0=master&amp;kdi0=8&amp;k1=%B7%D6%B2%BC%CA%BD&amp;kdi1=1&amp;k2=%C4%A3%D0%CD&amp;kdi2=1&amp;k3=%CD%A8%D0%C5&amp;kdi3=8&amp;k4=%BC%E0%BF%D8&amp;kdi4=8&amp;sid=68fcd10e2eb6714f&amp;ch=0&amp;tu=u1692056&amp;jk=183ed004c199001e&amp;cf=29&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=3&amp;seller_id=1&amp;di=128" target="_blank">模型</a>，即所谓的配置中心，顾名思义就是发布者将数据发布到ZK节点上，供订阅者动态获取数据，实现配置信息的集中式管理和动态更新。例如全局的配置信息，服务式服务框架的服务地址列表等就非常适合使用。<br><br>分布式锁<br><br>在一台机器上要多个进程或者多个线程操作同一资源比较简单，因为可以有大量的状态信息或者日志信息提供保证，比如两个A和B进程同时写一个文件，加锁就可以实现。但是分布式系统怎么办？需要一个三方的分配锁的机制，几百台worker都对同一个网络中的文件写操作，怎么协同？还有怎么保证高效的运行？<br>解决问题:<br></span></span></span></span></span></p>
<ul>
<li>高效<span id="1_nwp"><a id="1_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Eaboutyun%2Ecom%2Fthread%2D9266%2D1%2D1%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=92051019_cpr&amp;k=%B7%D6%B2%BC%CA%BD&amp;k0=master&amp;kdi0=8&amp;k1=%B7%D6%B2%BC%CA%BD&amp;kdi1=1&amp;k2=%C4%A3%D0%CD&amp;kdi2=1&amp;k3=%CD%A8%D0%C5&amp;kdi3=8&amp;k4=%BC%E0%BF%D8&amp;kdi4=8&amp;sid=68fcd10e2eb6714f&amp;ch=0&amp;tu=u1692056&amp;jk=183ed004c199001e&amp;cf=29&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=2&amp;seller_id=1&amp;di=128" target="_blank">分布式</a>的分布式锁<br></span></li>


</ul>
<p>
<span><span><span><span><span><br>zookeeper分布式锁<br><br><span><a id="4_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Eaboutyun%2Ecom%2Fthread%2D9266%2D1%2D1%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=92051019_cpr&amp;k=%B7%D6%B2%BC%CA%BD&amp;k0=master&amp;kdi0=8&amp;k1=%B7%D6%B2%BC%CA%BD&amp;kdi1=1&amp;k2=%C4%A3%D0%CD&amp;kdi2=1&amp;k3=%CD%A8%D0%C5&amp;kdi3=8&amp;k4=%BC%E0%BF%D8&amp;kdi4=8&amp;sid=68fcd10e2eb6714f&amp;ch=0&amp;tu=u1692056&amp;jk=183ed004c199001e&amp;cf=29&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=2&amp;seller_id=1&amp;di=128" target="_blank">分布式</a>锁主要得益于ZooKeeper为我们保证了数据的强一致性，zookeeper的znode节点创建的唯一性和递增性能保证所有来抢锁的worker的原子性。<br><br>集群worker管理<br><br>集群中的worker挂了是很可能的，一旦workerA挂了，如果存在其余的workers互相之间需要<span><a id="2_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Eaboutyun%2Ecom%2Fthread%2D9266%2D1%2D1%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=92051019_cpr&amp;k=%CD%A8%D0%C5&amp;k0=master&amp;kdi0=8&amp;k1=%B7%D6%B2%BC%CA%BD&amp;kdi1=1&amp;k2=%C4%A3%D0%CD&amp;kdi2=1&amp;k3=%CD%A8%D0%C5&amp;kdi3=8&amp;k4=%BC%E0%BF%D8&amp;kdi4=8&amp;sid=68fcd10e2eb6714f&amp;ch=0&amp;tu=u1692056&amp;jk=183ed004c199001e&amp;cf=29&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=4&amp;seller_id=1&amp;di=128" target="_blank">通信</a>，那么workers必须尽快更新自己的hosts列表，把挂了的worker剔除，从而不在和它通信，而Master要做的是把挂了worker上的作业调度到其他的worker上。同样的，这台worker重新恢复正常了，要通知其他的workers更新hosts列表。传统的作法都是有专门的<span><a id="3_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Eaboutyun%2Ecom%2Fthread%2D9266%2D1%2D1%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=92051019_cpr&amp;k=%BC%E0%BF%D8&amp;k0=master&amp;kdi0=8&amp;k1=%B7%D6%B2%BC%CA%BD&amp;kdi1=1&amp;k2=%C4%A3%D0%CD&amp;kdi2=1&amp;k3=%CD%A8%D0%C5&amp;kdi3=8&amp;k4=%BC%E0%BF%D8&amp;kdi4=8&amp;sid=68fcd10e2eb6714f&amp;ch=0&amp;tu=u1692056&amp;jk=183ed004c199001e&amp;cf=29&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=5&amp;seller_id=1&amp;di=128" target="_blank">监控</a>系统，通过不断去发心跳包(比如ping)来发现worker是否alive，缺陷就是及时性问题，不能应用于在线率要求较高的场景<br>解决问题:<br></span></span></span></span></span></span></span></span></p>
<ul>
<li>集群worker<span id="0_nwp"><a id="0_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Eaboutyun%2Ecom%2Fthread%2D9266%2D1%2D1%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=92051019_cpr&amp;k=%BC%E0%BF%D8&amp;k0=master&amp;kdi0=8&amp;k1=%B7%D6%B2%BC%CA%BD&amp;kdi1=1&amp;k2=%C4%A3%D0%CD&amp;kdi2=1&amp;k3=%CD%A8%D0%C5&amp;kdi3=8&amp;k4=%BC%E0%BF%D8&amp;kdi4=8&amp;sid=68fcd10e2eb6714f&amp;ch=0&amp;tu=u1692056&amp;jk=183ed004c199001e&amp;cf=29&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=5&amp;seller_id=1&amp;di=128" target="_blank">监控</a><br></span></li>


</ul>
<p>
<span id="7_nwp"><span id="8_nwp"><span id="6_nwp"><span id="5_nwp"><span id="4_nwp"><span id="2_nwp"><span id="3_nwp"><br>zookeeper监控集群<br><br>利用zookeeper建立znode的强一致性，可以用于那种对集群中机器状态，机器在线率有较高要求的场景，能够快速对集群中机器变化作出响应。<br><br><br><br>相关文章：<br><a href="http://www.aboutyun.com/forum.php?mod=viewthread&amp;tid=9292&amp;ctid=16" target="_blank">zookeeper原理</a><br><a href="http://www.aboutyun.com/forum.php?mod=viewthread&amp;tid=9291&amp;ctid=16" target="_blank">zookeeper中Watcher和Notifications</a>&nbsp;<br><a href="http://www.aboutyun.com/forum.php?mod=viewthread&amp;tid=9277&amp;ctid=16" target="_blank">zookeeper适用场景：如何竞选Master及代码实现</a><br><a href="http://www.aboutyun.com/forum.php?mod=viewthread&amp;tid=9271&amp;ctid=16" target="_blank">zookeeper适用场景：配置文件同步</a><br><a href="http://www.aboutyun.com/forum.php?mod=viewthread&amp;tid=9267&amp;ctid=16" target="_blank">zookeeper适用场景：分布式锁实现</a><br><a href="http://www.aboutyun.com/forum.php?mod=viewthread&amp;tid=9266&amp;ctid=16" target="_blank">zookeeper适用场景：zookeeper解决了哪些问题</a></span></span></span></span></span></span></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span>文章转自：http://www.aboutyun.com/thread-9266-1-1.html</span></p></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag">标签: <a href="https://www.cnblogs.com/likehua/tag/hadoop/">hadoop</a>, <a href="https://www.cnblogs.com/likehua/tag/zookeeper/">zookeeper</a></div>
<div id="blog_post_info"><div id="green_channel">
        <a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(3999600,cb_blogId,1);green_channel_success(this,'谢谢推荐！');">好文要顶</a>
            <a id="green_channel_follow" onclick="follow('5852238d-7c2e-df11-ba8f-001cf0cd104b');" href="javascript:void(0);">关注我</a>
    <a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a>
    <a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="//common.cnblogs.com/images/icon_weibo_24.png" alt=""></a>
    <a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信" onclick="shareOnWechat()"><img src="//common.cnblogs.com/images/wechat.png" alt=""></a>
</div>
<div id="author_profile">
    <div id="author_profile_info" class="author_profile_info">
            <a href="http://home.cnblogs.com/u/likehua/" target="_blank"><img src="//pic.cnblogs.com/face/sample_face.gif" class="author_avatar" alt=""></a>
        <div id="author_profile_detail" class="author_profile_info">
            <a href="http://home.cnblogs.com/u/likehua/">李克华</a><br>
            <a href="http://home.cnblogs.com/u/likehua/followees">关注 - 7</a><br>
            <a href="http://home.cnblogs.com/u/likehua/followers">粉丝 - 354</a>
        </div>
    </div>
    <div class="clear"></div>
    <div id="author_profile_honor"></div>
    <div id="author_profile_follow">
                <a href="javascript:void(0);" onclick="follow('5852238d-7c2e-df11-ba8f-001cf0cd104b');return false;">+加关注</a>
    </div>
</div>
<div id="div_digg">
    <div class="diggit" onclick="votePost(3999600,'Digg')">
        <span class="diggnum" id="digg_count">2</span>
    </div>
    <div class="buryit" onclick="votePost(3999600,'Bury')">
        <span class="burynum" id="bury_count">1</span>
    </div>
    <div class="clear"></div>
    <div class="diggword" id="digg_tips">
    </div>
</div>
<script type="text/javascript">
    currentDiggType = 0;
</script></div>
<div class="clear"></div>
<div id="post_next_prev"><a href="https://www.cnblogs.com/likehua/p/3999592.html" class="p_n_p_prefix">« </a> 上一篇：<a href="https://www.cnblogs.com/likehua/p/3999592.html" title="发布于2014-09-29 09:57">ZooKeeper系列4：ZooKeeper API简介及编程</a><br><a href="https://www.cnblogs.com/likehua/p/3999610.html" class="p_n_p_prefix">» </a> 下一篇：<a href="https://www.cnblogs.com/likehua/p/3999610.html" title="发布于2014-09-29 10:05">ZooKeeper架构设计及其应用要点</a><br></div>
</div>


		</div>
		<div class="postDesc">posted @ <span id="post-date">2014-09-29 10:01</span> <a href="https://www.cnblogs.com/likehua/">李克华</a> 阅读(<span id="post_view_count">23571</span>) 评论(<span id="post_comment_count">0</span>)  <a href="https://i.cnblogs.com/EditPosts.aspx?postid=3999600" rel="nofollow">编辑</a> <a href="#" onclick="AddToWz(3999600);return false;">收藏</a></div>
	</div>
